<html>
  <head>
     <meta charset="UTF-8">
	 <title>Title</title>
	 <script type="text/javascript" src="./index.js"></script>
  </head>
<body>
	<div>
	    <input type="text" id="txt">
	    <input type="button" id="connect" value="连接" onclick="connectting()">
	    <input type="button" id="submit" value="发送数据" onclick="sendMsg()">
	    <input type="button" id="close" value="关闭连接" onclick="closeConn()">
	</div>

   <div id="info"></div>
   <script>
   		// let Websocket = require("./index.js");
   		// console.log(ClientSocket.ws.onopen)
   		let msg = {
				"dfhj": "dfhjdf",
				"dfdf": "fgjg",
				"title": "Q",
				"longName": "李四",
				"people": [
					{ "firstName": "Brett", "lastName":"McLaughlin", "email": "aaaa" },
					{ "firstName": "Jason", "lastName":"Hunter", "email": "bbbb"},
					{ "firstName": "Elliotte", "lastName":"Harold", "email": "cccc" },
					{ "secondName": "Brett", "lastName":"McLaughlin", "email": "aaaa" },
					{ "secondName": "Jason", "lastName":"Hunter", "email": "bbbb"},
					{ "secondName": "Elliotte", "lastName":"Harold", "email": "cccc" },
					{ "firstName": "Brett", "lastName":"HJDFdfdf", "email": "aaaa" },
					{ "firstName": "Jason", "lastName":"Hdfdf", "email": "bbbb"},
					{ "firstName": "Elliotte", "lastName":"Hdfld", "email": "cccc" }
				]
		};
   	 	let client;
   	 	let err = "";
   	 	let NoError = "";
   	 	let ele = document.createElement('div');
		function connectting() {
			
			if (client != undefined && client.readyState == 2) {
				ele.innerText = '【服务端 已连接】';
				document.getElementById('info').appendChild(ele);
				return;
			}
			
			if (!window.WebSocket) {
	            ele.innerText = "  您的浏览器不支持ws<br/>";
	            document.getElementById('info').appendChild(ele);
	            return;
	        }
		        // ws://192.168.200.93:8888/
			   // ws://192.168.200.115:8888/
			   // wss://echo.websocket.org
			// client = new ClientSocket('ws://192.168.200.93:8888/');
			client = new ClientSocket('ws://192.168.200.113:8888/');
			client.connect(function(readyState) {
				if (readyState == 2) {
					ele.innerText = '【服务端 处于正常服务】';
				} else if (readyState == 4) {
					ele.innerText = '【服务端 处于关闭状态】';
				} else{
					ele.innerText = '【服务端 处于异常服务】' + readyState;
				}
				document.getElementById('info').appendChild(ele);
			});
		}

		function sendMsg() {
			let ele = document.createElement('div');
			let txt = document.getElementById('txt');
			let value = txt.value;
			if (client == undefined) {
				ele.innerText = "未连接服务器，请先连接服务器！";
	        	document.getElementById('info').appendChild(ele);
	        	return;
			}
			if (value == "") {
				ele.innerText = "数据不能为空！";
	        	document.getElementById('info').appendChild(ele);
	        	return;
			}
			client.sendData(txt.value);
			client.ws.onmessage = (result) => {
				let dataMsg = client.getData(result.data).then((data) => {
					console.log("Rece data", data);
					if (!data.hasOwnProperty("arg")) {
						return;
					}
			    	ele.innerText = '【接收到数据】' + data.arg;
			    }).catch((error) => {
			    	ele.innerText = '【接收到异常数据为】' + error;
			    });
			    document.getElementById('info').appendChild(ele);
			}
	       
		}

		function closeConn() {
			let ele = document.createElement('div');
			if (client == undefined || (client.readyState == 4)) {
				ele.innerText = '【客户端 已断开连接】';
				document.getElementById('info').appendChild(ele);
				return;
			}
			client.close().then((result) => {
				console.log("closing : " ,result);
				ele.innerText = '【客户端 关闭连接】';
				document.getElementById('info').appendChild(ele);
			}).catch((error) => {
				ele.innerText = '【客户端 关闭连接失败】' + error;
				 document.getElementById('info').appendChild(ele);
			}); 
	       
		}
   </script>
   
</body>
</html>